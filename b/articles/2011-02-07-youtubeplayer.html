<!doctype html>  

<html lang="en">
  <head>
    <meta charset="utf-8">
    
    <title>mazzo.li - Controlling YouTube videos with JS</title>
    
    <meta name="author" content="Francesco Mazzoli <f@mazzo.li>">
    
    <link rel="stylesheet" type="text/css" href="../css/fonts/fonts.css" />
    <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
    <link rel="stylesheet" type="text/css" href="../css/default.css" />
    <script type="text/javascript" src="http://mazzo.li/jslibs/mootools-1.3-yc.js"></script>
    <script type="text/javascript" src="../js/style.js"></script>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-17362921-2']);
      _gaq.push(['_trackPageview']);
      
      (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body>
    <h1><a href="..">mazzo.li</a></h1>
    <div id="article">
  <h2><em>Feb  7, 2011</em> Controlling YouTube videos with JS</h2>
  
  <p>Some days ago I had some ideas in mind that involved using the <a href="http://code.google.com/apis/youtube/js_api_reference.html">YouTube Javascript API</a>, and I quickly realized how messy the whole thing was. While the API lets you control really everything about the playback of the video, it also makes you do horrible things in the process, like defining global functions with a pre-defined name, or handling events passing the function names as strings.</p>
<h3 id="the-youtubeplayer-mootools-class">The YouTubePlayer MooTools class</h3>
<p>So I decided to make things a little bit less ugly, and I wrote a <a href="http://mootools.net/">MooTools</a> class that hides all the bad bits and makes you happy. <strong>You can download it, browse the code, fork it and many other things on <a href="https://github.com/rostayob/YouTubePlayer">github</a></strong>.</p>
<p>For all the people who don’t like to read, here’s an example on what you can do with it:</p>
<div id="demo1">
You need Javascript to play YouTube videos!
</div>

<p>For a more comprehensive example, check the <a href="#a-more-serious-demo">demo</a> at the bottom of the page.</p>
<h3 id="creating-the-youtubeplayer-object">Creating the YouTubePlayer object</h3>
<p>To use the class, all you have to to is to create a new element, and then inject it somewhere:</p>
<pre class="sourceCode"><code class="sourceCode javascript"><span class="kw">var</span> player = <span class="kw">new</span> YouTubePlayer({<br />                 <span class="dt">width</span>: <span class="dv">425</span>,<br />                 <span class="dt">height</span>: <span class="dv">356</span>,<br />                 <span class="dt">videoId</span>: <span class="ch">'XDZ31YQvxWY'</span>,<br />                 <span class="dt">id</span>: <span class="ch">'videoPlayer'</span>,<br />                 <span class="dt">embedded</span>: <span class="kw">false</span>,<br />                 <span class="dt">suggestedQuality</span>: <span class="ch">'large'</span><br />             });<br /><br />$(<span class="ch">'playerDiv'</span>).<span class="fu">grab</span>(player);</code></pre>
<p>The initializer accepts all the <a href="http://mootools.net/docs/core/Utilities/Swiff">Swiff</a> options, plus the following:</p>
<ul>
<li><code>videoId</code>: A string containing the id if the video (if the URL is “<code>http://www.youtube.com/watch?v=Em80ViNVlHM</code>” then your id is “<code>Em80ViNVlHM</code>”).</li>
<li><code>embedded</code>: A boolean that determines wheter the video is in the old embedded style or as a bare video. Both versions are controllable via the js api.</li>
<li><code>suggestedQuality</code>: A string with the quality you would like to have with your video. The “suggested” is because that quality might not be available. In that case, the quality will be set to the next lowest level that is available. The quality levels available are <code>small</code>, <code>medium</code>, <code>large</code>, <code>hd720</code>, <code>hd1080</code>, <code>highres</code> or <code>default</code>. <code>default</code> is not an actual quality level, but simply instructs YouTube to select the most appropriate playback quality, which will vary for different users, videos, systems and other playback conditions.</li>
</ul>
<h3 id="controlling-the-player">Controlling the player</h3>
<p>To control the player you should refer to the <a href="http://code.google.com/apis/youtube/js_api_reference.html#Operations">official API operations</a>, with the following differences:</p>
<ul>
<li>All the functions that return <code>void</code> get enqueued if the player is not ready yet and will be executed when the player will become ready. The functions that are supposed to return something return <code>null</code> if the player is not ready.</li>
<li><code>cueVideoById</code> and <code>cueVideoByUrl</code> got replaced by <code>cueVideo</code>, and similarly <code>loadVideoById</code> and <code>loadVideoByUrl</code> got replaced by <code>loadVideo</code>. Just pass the url or id, and the class will guess if it is an id or an url.</li>
<li>Events are handled in the usual MooTools way instead that with the <code>addEventListener</code> function. The available events are <code>playerReady</code>, <code>stateChange</code>, <code>playbackQualityChange</code> and <code>error</code>. Please note that if you add a <code>playerReady</code> event when the player is ready, the function will be executed straight away. <br/>Example:</li>
</ul>
<pre class="sourceCode"><code class="sourceCode javascript"><span class="kw">player</span>.<span class="fu">addEvent</span>(<span class="ch">'stateChange'</span>, <span class="kw">function</span>(state) {<br />    <span class="kw">console</span>.<span class="fu">log</span>(<span class="ch">'State changed to '</span> + state);<br />});</code></pre>
<p>If you really want to control the flash object itself you can do it via the <code>object</code> object of the YouTubePlayer class.</p>
<h3 id="a-more-serious-demo">A more serious demo</h3>
<p>To test all the features I created a demo that mimicks the <a href="http://code.google.com/apis/youtube/youtube_player_demo.html">official one</a>, plus the possibility of changing the player type without reloading the page.</p>
<div id="demo2">
You need Javascript to play YouTube videos!
</div>

<script type="text/javascript" src="http://mazzo.li/jslibs/json2-yc.js"></script>
<script type="text/javascript" src="http://mazzo.li/jslibs/mootools-more-1.3-yc.js"></script>
<script type="text/javascript" src="http://mazzo.li/jslibs/YouTubePlayer.js"></script>
<script type="text/javascript" src="../js/youtubeplayer-article.js"></script>



  <div id="disqus_thread"></div>
  <script type="text/javascript">
      var disqus_shortname = 'mazzoli-blog';

      var disqus_identifier = 'articles/2011-02-07-youtubeplayer.markdown';
      var disqus_url = 'http://mazzo.li/b/articles/2011-02-07-youtubeplayer.html';

      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the comments.</noscript>

</div>

    <div id="footer"> <a href="https://github.com/rostayob">github</a>
      &middot; All enquiries
      to <a href="mailto:f@mazzo.li">f@mazzo.li</a>.</div>
  </body>
</html>
